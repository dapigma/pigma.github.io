<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBPKc8wc6SWu6jCAOLQhdI4zADrTbiuNuE",
      authDomain: "afterlifeleaderboard.firebaseapp.com",
      databaseURL: "https://afterlifeleaderboard-default-rtdb.firebaseio.com",
      projectId: "afterlifeleaderboard",
      storageBucket: "afterlifeleaderboard.firebasestorage.app",
      messagingSenderId: "799716843731",
      appId: "1:799716843731:web:f41e5cded386453c83f426",
      measurementId: "G-D3E3W4ZKJD"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <style>
    .nav-bar a {
      position: relative;
      transition: color 0.3s ease;
    }
    .nav-bar a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -2px;
      width: 100%;
      height: 2px;
      background-color: rgba(168, 85, 247, 0.6);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }
    .nav-bar a:hover {
      color: #a855f7;
    }
    .nav-bar a:hover::after {
      transform: scaleX(1);
    }
  </style>
</head>
<!-- Header -->
  <header class="w-full bg-gray-900 flex items-center justify-center py-6 px-4 space-x-4 relative z-10">
    <img src="IMGS/Orion.png" alt="Logo" class="w-16 h-16" />
    <div class="text-center">
      <h1 class="text-4xl font-bold cursor-pointer" onclick="openGame()">Afterlife Gaming 
      </h1>
      <div id="time" class="text-sm text-gray-300"></div>
    </div>
  </header>

  <!-- Divider -->
  <div class="h-1 bg-gradient-to-r from-purple-500 via-indigo-500 to-purple-500 z-20 relative"></div>

  <!-- Navigation -->
    <nav class="nav-bar w-screen bg-gray-800 p-4 flex justify-center gap-6 text-lg m-0 z-10 relative">
    <a href="Home.html" class="hover:text-purple-400 nav-tab"><i class="fas fa-home"></i> Home</a>
    <a href="Games.html" class="hover:text-purple-400 nav-tab"><i class="fas fa-gamepad"></i> Games</a>
    <a href="chat.html?prev=Home.html" class="hover:text-purple-400 nav-tab"><i class="fas fa-comments"></i> Chat</a>
    <a href="Forms.html" class="hover:text-purple-400 nav-tab"><i class="fa-solid fa-pen-to-square"></i> Forms</a>
    <a href="appel-levels.html" class="hover:text-purple-400 nav-tab"><i class="fa-solid fa-apple-whole"></i> Appel Levels</a>
    <a href="Haks.html" class="hover:text-purple-400"><i class="fa-solid fa-bolt"></i> Hacks</a>
    <a href="Leaderboard.html" class="hover:text-purple-400"><i class="fa-solid fa-medal"></i></i> LeaderBoard</a>
      <button id="adminLoginBtn" class="text-white bg-purple-600 px-3 py-1 rounded hover:bg-purple-700">Admin Login</button>
    </nav>
  </header>

  <main class="flex flex-col items-center mt-10 px-4">
    <form id="scoreForm" class="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md mb-8 space-y-4">
      <input type="text" id="name" placeholder="Your Name" required class="w-full p-2 rounded bg-gray-900 text-white border border-gray-600" />
      <select id="game" required class="w-full p-2 rounded bg-gray-900 text-white border border-gray-600">
        <option value="appel">Appel</option>
        <option value="slope">Slope</option>
      </select>
      <input type="number" id="score" placeholder="Time" required class="w-full p-2 rounded bg-gray-900 text-white border border-gray-600" />
      <p class="text-sm text-gray-300">📷 Send a screenshot of your final screen to <strong>afterlifegaminghelp@outlook.com</strong></p>
      <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded font-semibold">Submit Score</button>
    </form>

    <div id="successPopup" class="hidden fixed top-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded shadow z-50">Score submitted successfully!</div>

    <div class="w-full max-w-6xl flex gap-6 overflow-x-auto">
      <div class="w-1/2 overflow-y-auto max-h-[400px]">
        <h2 class="text-xl font-semibold mb-3 text-purple-300">Top Scores - Appel</h2>
        <ul id="appelBoard" class="space-y-2"></ul>
      </div>
      <div class="w-1/2 overflow-y-auto max-h-[400px]">
        <h2 class="text-xl font-semibold mb-3 text-purple-300">Top Scores - Slope</h2>
        <ul id="slopeBoard" class="space-y-2"></ul>
      </div>
    </div>

    <div id="adminPanel" class="hidden w-full max-w-2xl mt-12 bg-gray-900 p-6 rounded-lg">
      <h2 class="text-xl font-bold text-green-400 mb-4">Pending Submissions</h2>
      <ul id="pendingList" class="space-y-4"></ul>
    </div>

    <div id="adminModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
      <div class="bg-gray-800 p-6 rounded shadow-lg w-80">
        <h2 class="text-xl font-semibold mb-4">Admin Login</h2>
        <input type="password" id="adminPassword" placeholder="Enter Secret Code" class="w-full p-2 rounded bg-gray-900 text-white border border-gray-600 mb-4" />
        <div class="flex justify-end gap-2">
          <button id="cancelLogin" class="bg-gray-600 px-4 py-1 rounded hover:bg-gray-700">Cancel</button>
          <button id="confirmLogin" class="bg-purple-600 px-4 py-1 rounded hover:bg-purple-700">Login</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    const form = document.getElementById("scoreForm");
    const gameSelect = document.getElementById("game");
    const scoreInput = document.getElementById("score");
    const adminLoginBtn = document.getElementById("adminLoginBtn");
    const adminModal = document.getElementById("adminModal");
    const cancelLogin = document.getElementById("cancelLogin");
    const confirmLogin = document.getElementById("confirmLogin");
    const adminPassword = document.getElementById("adminPassword");
    const adminPanel = document.getElementById("adminPanel");
    const successPopup = document.getElementById("successPopup");

    gameSelect.addEventListener("change", () => {
      scoreInput.placeholder = gameSelect.value === "appel" ? "Time" : "Score";
    });

    adminLoginBtn.addEventListener("click", () => {
      adminModal.classList.remove("hidden");
    });

    cancelLogin.addEventListener("click", () => {
      adminModal.classList.add("hidden");
    });

    confirmLogin.addEventListener("click", () => {
      const code = adminPassword.value.trim();
      fetch("config.json")
        .then(res => res.json())
        .then(config => {
          if (code === config.secretCode) {
            adminPanel.classList.remove("hidden");
            adminModal.classList.add("hidden");
            loadPending();
          } else {
            alert("Incorrect code.");
          }
        })
        .catch(() => alert("Could not load config."));
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const lastSubmit = localStorage.getItem("lastSubmitTime");
      const now = Date.now();
      if (lastSubmit && now - parseInt(lastSubmit) < 30000) {
        alert("Please wait a few seconds before submitting again.");
        return;
      }

      const name = document.getElementById("name").value.trim();
      const score = parseFloat(scoreInput.value);
      const game = gameSelect.value;

      if (!name || isNaN(score)) return;

      const entry = {
        name,
        score,
        game,
        timestamp: Date.now(),
        approved: false
      };

      try {
        await firebase.database().ref(`${game}_scores`).push(entry);
        localStorage.setItem("lastSubmitTime", Date.now());
        successPopup.classList.remove("hidden");
        setTimeout(() => successPopup.classList.add("hidden"), 3000);
        form.reset();
      } catch (error) {
        console.error("Error submitting score:", error);
        alert("Submission failed. Check console for details.");
      }
    });

    function loadLeaderboard(game, elementId, sortAsc = false) {
      const board = document.getElementById(elementId);
      firebase.database().ref(`${game}_scores`).orderByChild("approved").equalTo(true).once("value", (snapshot) => {
        const scores = [];
        snapshot.forEach(child => scores.push(child.val()));
        scores.sort((a, b) => sortAsc ? a.score - b.score : b.score - a.score);
        board.innerHTML = "";
        scores.forEach(entry => {
          const li = document.createElement("li");
          li.className = "bg-gray-800 p-3 rounded shadow";
          li.textContent = `${entry.name}: ${entry.score}`;
          board.appendChild(li);
        });
      });
    }

    function loadPending() {
      const pendingList = document.getElementById("pendingList");
      pendingList.innerHTML = "";
      ["appel", "slope"].forEach(game => {
        firebase.database().ref(`${game}_scores`).orderByChild("approved").equalTo(false).once("value", snapshot => {
          snapshot.forEach(child => {
            const data = child.val();
            const li = document.createElement("li");
            li.id = `pending-${child.key}`;
            li.className = "bg-gray-800 p-3 rounded shadow flex justify-between items-center";
            li.innerHTML = `
              <span>${data.name} (${game}) - ${data.score}</span>
              <div class="flex gap-2">
                <button class='bg-green-600 px-2 py-1 rounded hover:bg-green-700' onclick='approveEntry("${game}", "${child.key}")'>Approve</button>
                <button class='bg-red-600 px-2 py-1 rounded hover:bg-red-700' onclick='denyEntry("${game}", "${child.key}")'>Deny</button>
              </div>`;
            pendingList.appendChild(li);
          });
        });
      });
    }

    function approveEntry(game, key) {
      firebase.database().ref(`${game}_scores/${key}/approved`).set(true);
      const item = document.getElementById(`pending-${key}`);
      if (item) item.remove();
    }

    function denyEntry(game, key) {
      firebase.database().ref(`${game}_scores/${key}`).remove();
      const item = document.getElementById(`pending-${key}`);
      if (item) item.remove();
    }

    loadLeaderboard("appel", "appelBoard", true);
    loadLeaderboard("slope", "slopeBoard", false);

    const canvas = document.getElementById("particleCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    class Particle {
      constructor() {
        this.radius = Math.random() * 6 + 4;
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + this.radius;
        this.speedY = Math.random() * 4 + 2;
        this.opacity = Math.random() * 0.5 + 0.5;
      }
      update() {
        this.y -= this.speedY;
        if (this.y < -this.radius) {
          this.y = canvas.height + this.radius;
          this.x = Math.random() * canvas.width;
        }
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.shadowBlur = 20;
        ctx.shadowColor = "rgba(82, 23, 124, 1)";
        ctx.fillStyle = `rgba(82, 23, 124, ${this.opacity})`;
        ctx.fill();
        ctx.closePath();
      }
    }

    let particles = [];
    function init() {
      particles = [];
      for (let i = 100; i--;) {
        particles.push(new Particle());
      }
    }
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => { p.update(); p.draw(); });
      requestAnimationFrame(animate);
    }
    resizeCanvas();
    init();
    animate();
    window.addEventListener("resize", resizeCanvas);
    // ✅ Add this logic inside your <script> tag if it's not already there

// 🔐 Admin login logic
confirmLogin.addEventListener("click", () => {
  const code = adminPassword.value.trim();
  fetch("config.json")
    .then(res => res.json())
    .then(config => {
      if (code === config.secretCode) {
        adminPanel.classList.remove("hidden");
        adminModal.classList.add("hidden");
        loadPending();
      } else {
        alert("Incorrect code.");
      }
    })
    .catch(() => alert("Could not load config."));
});

// 📥 Load pending entries for admin review
function loadPending() {
  const pendingList = document.getElementById("pendingList");
  pendingList.innerHTML = "";
  ["appel", "slope"].forEach(game => {
    firebase.database().ref(`${game}_scores`).orderByChild("approved").equalTo(false).once("value", snapshot => {
      snapshot.forEach(child => {
        const data = child.val();
        const li = document.createElement("li");
        li.id = `pending-${child.key}`;
        li.className = "bg-gray-800 p-3 rounded shadow flex justify-between items-center";
        li.innerHTML = `
          <span>${data.name} (${game}) - ${data.score}</span>
          <div class="flex gap-2">
            <button onclick="approveEntry('${game}', '${child.key}')" class="bg-green-600 hover:bg-green-700 px-2 py-1 rounded">Approve</button>
            <button onclick="denyEntry('${game}', '${child.key}')" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded">Deny</button>
          </div>`;
        pendingList.appendChild(li);
      });
    });
  });
}

// ✅ Approval logic
function approveEntry(game, key) {
  firebase.database().ref(`${game}_scores/${key}/approved`).set(true);
  const item = document.getElementById(`pending-${key}`);
  if (item) item.remove();
}

function denyEntry(game, key) {
  firebase.database().ref(`${game}_scores/${key}`).remove();
  const item = document.getElementById(`pending-${key}`);
  if (item) item.remove();
}

// ✅ Updated leaderboard loader with numbering
function loadLeaderboard(game, elementId, sortAsc = false) {
  const board = document.getElementById(elementId);
  board.innerHTML = "<li class='text-gray-400 italic'>Loading...</li>";

  firebase.database().ref(`${game}_scores`).once("value").then(snapshot => {
    const scores = [];
    snapshot.forEach(child => {
      const val = child.val();
      if (val.approved === true) {
        scores.push(val);
      }
    });

    scores.sort((a, b) => sortAsc ? a.score - b.score : b.score - a.score);

    board.innerHTML = "";
    if (scores.length === 0) {
      board.innerHTML = "<li class='text-gray-400 italic'>No approved scores yet.</li>";
      return;
    }

    scores.forEach((entry, index) => {
      const li = document.createElement("li");
      li.className = "bg-gray-800 p-3 rounded shadow";
      li.textContent = `#${index + 1} ${entry.name}: ${entry.score}`;
      board.appendChild(li);
    });
  });
}  

// Load both leaderboards on page load
loadLeaderboard("appel", "appelBoard", true);
loadLeaderboard("slope", "slopeBoard", false);
      // Time display
    function updateTime() {
      const options = { weekday: 'long', hour: 'numeric', minute: '2-digit', hour12: true };
      const now = new Date();
      document.getElementById('time').textContent = now.toLocaleString('en-US', options);
    }
    setInterval(updateTime, 1000);
    updateTime();
  </script>
</body>
</html>
